{% extends "blog/base.html" %}
{% load crispy_forms_tags %}
{% block content %}

<!-- Get Back Button -->
<div class="mb-3">
    <a href="{% url 'post-detail' post.pk %}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Get Back to Post
    </a>
</div>

<div class="content-section">
    <form method="POST">
        {% csrf_token %}
        <fieldset class="form-group">
            <legend class="border-bottom mb-4">
                <i class="fas fa-edit"></i> Update Post
            </legend>
            {{ form|crispy }}
        </fieldset>
        <div class="form-group">
            <button class="btn btn-outline-info" type="submit">
                <i class="fas fa-save"></i> Update Post
            </button>
            <a href="{% url 'post-detail' post.pk %}" class="btn btn-outline-secondary">
                <i class="fas fa-times"></i> Cancel
            </a>
        </div>
    </form>
</div>

<script>
function toggleCustomCategory(categoryValue) {
    const customCategoryField = document.getElementById('id_custom_category');
    const customCategoryLabel = document.querySelector('label[for="id_custom_category"]');
    const customCategoryHelp = customCategoryField.parentNode.querySelector('.form-text');
    
    if (categoryValue === 'other') {
        customCategoryField.style.display = 'block';
        customCategoryField.required = true;
        if (customCategoryLabel) customCategoryLabel.style.display = 'block';
        if (customCategoryHelp) customCategoryHelp.style.display = 'block';
    } else {
        customCategoryField.style.display = 'none';
        customCategoryField.required = false;
        customCategoryField.value = '';
        if (customCategoryLabel) customCategoryLabel.style.display = 'none';
        if (customCategoryHelp) customCategoryHelp.style.display = 'none';
    }
}

// Initialize the form state when page loads
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('id_category');
    if (categorySelect) {
        toggleCustomCategory(categorySelect.value);
    }
});
</script>

{% endblock content %}