{% extends "blog/base.html" %}
{% block content %} 
{% for post in posts %}
<article class="media content-section">
  <img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}">
  <div class="media-body">
    <div class="article-metadata">
      <a class="mr-2" href="{% url 'user-posts' post.author.username %}">{{ post.author }}</a>
      <small class="text-muted">{{ post.date_posted|date:"F d, Y" }}</small>
      <span class="badge badge-primary ml-2">{{ post.get_category_display_name }}</span>
    </div>
    <h2><a class="article-title" href="{% url 'post-detail' post.id %}">{{ post.title }}</a></h2>
    <div class="article-content">
      {% if post.content|length > 300 %}
        <p class="post-preview" id="preview-{{ post.pk }}">
          {{ post.content|truncatechars:250 }}
          <a href="#" class="text-info read-more-link" onclick="expandPost({{ post.pk }}); return false;">Read more...</a>
        </p>
        <div class="post-full-content" id="full-{{ post.pk }}" style="display: none;">
          <p>{{ post.content|linebreaks }}</p>
          <a href="#" class="text-info read-less-link" onclick="collapsePost({{ post.pk }}); return false;">Show less</a>
        </div>
      {% else %}
        <div class="post-full-display">{{ post.content|linebreaks }}</div>
      {% endif %}
    </div>
  </div>
</article>
{% empty %}
<div class="content-section">
  <p>No posts yet. <a href="{% url 'post-create' %}">Create the first post!</a></p>
</div>
{% endfor %} 

<!-- Pagination -->
{% if posts.has_other_pages %}
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {% if posts.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page=1">&laquo; First</a>
      </li>
      <li class="page-item">
        <a class="page-link" href="?page={{ posts.previous_page_number }}">Previous</a>
      </li>
    {% endif %}
    
    {% for num in posts.paginator.page_range %}
      {% if posts.number == num %}
        <li class="page-item active">
          <span class="page-link">{{ num }} <span class="sr-only">(current)</span></span>
        </li>
      {% elif num > posts.number|add:'-3' and num < posts.number|add:'3' %}
        <li class="page-item">
          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
      {% endif %}
    {% endfor %}
    
    {% if posts.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ posts.next_page_number }}">Next</a>
      </li>
      <li class="page-item">
        <a class="page-link" href="?page={{ posts.paginator.num_pages }}">Last &raquo;</a>
      </li>
    {% endif %}
  </ul>
</nav>

<div class="text-center mt-3">
  <small class="text-muted">
    Page {{ posts.number }} of {{ posts.paginator.num_pages }} 
    ({{ posts.paginator.count }} total posts)
  </small>
</div>
{% endif %}

<script>
function expandPost(postId) {
    const preview = document.getElementById('preview-' + postId);
    const fullContent = document.getElementById('full-' + postId);
    
    if (preview && fullContent) {
        preview.style.display = 'none';
        fullContent.style.display = 'block';
        
        // Smooth scroll to the post for better UX
        const postElement = document.getElementById('post-' + postId);
        if (postElement) {
            postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }
}

function collapsePost(postId) {
    const preview = document.getElementById('preview-' + postId);
    const fullContent = document.getElementById('full-' + postId);
    
    if (preview && fullContent) {
        preview.style.display = 'block';
        fullContent.style.display = 'none';
        
        // Smooth scroll back to the post for better UX
        const postElement = document.getElementById('post-' + postId);
        if (postElement) {
            postElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
}
</script>

{% endblock content %}
